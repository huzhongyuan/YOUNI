<script type="text/javascript" src = "../js/module/header.js" data-css = "communityInfo" data-title = "communityInfo"></script>



<body>
		  <!-- 页头开始 -->
    <header>
      <script type="text/javascript" src = "../js/module/nav.js"></script>
    </header>
          <!-- 页头结束 -->

          <div class="container" style="margin-top:30px;margin-bottom:20px;text-align:center;font-size:20px;width:940px;">
            <div class="notification">
              话题社区
            </div>
          </div>

          <!-- <article class="media" style="width:900px;margin:0px auto;margin-top:20px;">
            <figure class="media-left">
              <p class="image is-64x64">
                <img src="https://bulma.io/images/placeholders/128x128.png">
              </p>
            </figure>

            <div class="media-content">
              <div class="field">
                <p class="control">
                  <textarea class="textarea" placeholder="Add a comment..."></textarea>
                </p>
              </div>
              <div class="field">
                <p class="control">
                  <button class="button is-success" style="float:right;">发表</button>
                </p>
              </div>
            </div>
          </article> -->



<div style="width:900px;margin:0px auto;">
  <article class="media">
    <figure class="media-left">
      <p class="image is-64x64">
        <img src="https://bulma.io/images/placeholders/128x128.png">
      </p>
    </figure>
    <div class="media-content" id="mediaContent">
      <div class="content">
        <p>
          <span class="title" style="font-size:20px;"></span>
          <br>
          <span class="con"></span>
          <br>
          <span class="name" style="font-size:14px;float:right;margin-right:80px;"></span>
          <br>
          <small style="float:right;margin-right:80px;"><span class="praise" style="cursor:pointer;">👍+</span><span class="num">111</span>&nbsp;&nbsp;<span class="time">3 hrs</span></small>
          <br>
          <small style="float:right;margin-right:80px;font-size:12px;color:#cccccc;">浏览量：<span class="view" style="color:#cccccc;">11</span></small>
        </p>
      </div>



    </div>
  </article>
  <article class="media">
    <figure class="media-left">
      <p class="image is-64x64">
        <img src="https://bulma.io/images/placeholders/128x128.png">
      </p>
    </figure>
    <div class="media-content">
      <div class="field">
        <p class="control">
          <textarea class="textarea" id="replycontent" placeholder="Add a comment..."></textarea>
        </p>
      </div>
      <div class="field">
        <p class="control">
          <button class="button" id="reply">评论</button>
        </p>
      </div>
    </div>
  </article>
</div>


      <!-- 内容结束 -->

        <!-- 页脚开始 -->
    　<footer>
        <ul class="share-group">
          <li>1</li>
          <li>1</li>
          <li>1</li>
          <li>1</li>
          <li>1</li>
        </ul>
        <div class="copy">
            <span>©umeimmense</span>
        </div>

    </footer>
    <!-- 页脚结束 -->




    <div style="position:fixed;top:150px;right:50px;">
      <nav class="panel" id="topicBox">
        <p class="panel-heading">
          社区话题搜索
        </p>
        <div class="panel-block">
          <p class="control has-icons-left">
            <input class="input is-small" type="text" placeholder="search">
            <span class="icon is-small is-left">
              <i class="fa fa-search"></i>
            </span>
          </p>
        </div>
        <p class="panel-tabs">
          热议榜
        </p>


      </nav>
    </div>



		<!-- 内容结束 -->

		<!-- <script src="../js/size/TweenLite.min.js"></script>
		<script src="../js/size/EasePack.min.js"></script>
		<script src="../js/size/rAF.js"></script>
		<script src="../js/size/setsize.js"></script> -->
    <!-- 引入jquery文件 -->
    <!-- <script type="text/javascript" src="../js/lib/jquery.min.js"></script> -->
    <!-- 引入bootstrap.min.js文件 -->
    <!-- <script type="text/javascript" src="../bootstrap/js/bootstrap.min.js"></script> -->

		<div style="text-align:center;">
</div>
	</body>

<script type="text/jscript">
let topicId = sessionStorage.getItem('topicId');
let sid = sessionStorage.getItem('sid');
let title = document.getElementsByClassName('title')[0];
let con = document.getElementsByClassName('con')[0];
let name = document.getElementsByClassName('name')[0];
let time = document.getElementsByClassName('time')[0];
let num = document.getElementsByClassName('num')[0];
let view = document.getElementsByClassName('view')[0];
let mediaContent = document.getElementById('mediaContent');
let replycontent = document.getElementById('replycontent');
let reply = document.getElementById('reply');
let praise = document.getElementsByClassName('praise')[0];

//增加点赞量
praise.onclick = () => {
  $.ajax({
    type: 'post',
    datType: 'json',
    url: 'http://192.168.1.102:8080/YouNi/praise/' + topicId + '.do',
    success: function (json) {
      if (json.status == 1) {
        console.log('success');
        num.innerHTML = json.praise_amount;
      }else {
        alert('网络错误');
      }
    },

    error: function (json) {
      alert(JSON.stringify(json));
    },
  });
};

//增加浏览量
let addview = () => {
  $.ajax({
    type: 'post',
    datType: 'json',
    url: 'http://192.168.1.102:8080/YouNi/topic/click_amount.do',
    data: {
      topic_id: topicId,
    },
    success: function (json) {
      if (json.status == 1) {
      }else {
        alert('网络错误');
      }
    },

    error: function (json) {
      alert(JSON.stringify(json));
    },
  });
}

//增加浏览量
addview();

//加载话题
let topicajax = () => {

  $.ajax({
    type: 'get',
    datType: 'json',
    url: 'http://192.168.1.102:8080/YouNi/topic/one/' + topicId + '.do',
    success: function (json) {
      if (json.status == 1) {
        title.innerHTML = json.object.theme;
        con.innerHTML = json.object.description;
        name.innerHTML = json.object.userName;
        time.innerHTML = json.object.publish_time;
        num.innerHTML = json.object.praise_amount;
        view.innerHTML = json.object.click_amount;
      }else {
        alert('网络错误');
      }
    },

    error: function (json) {
      alert(JSON.stringify(json));
    },
  });
};

//加载话题
topicajax();

//加载评论
let commentajax = () => {
  $.ajax({
    type: 'get',
    datType: 'json',
    url: 'http://192.168.1.102:8080/YouNi/topicreply/' +  topicId + '.do',
    success: function (json) {
      if (json.status == 1) {
        console.log('success');
        for (let i in json.object) {
          let ms = document.createElement('media');
          ms.className = 'media';
          ms.innerHTML = '<figure class="media-left">' +
            '<p class="image is-48x48">' +
              '<img src="https://bulma.io/images/placeholders/96x96.png">' +
            '</p>' +
          '</figure>' +
          '<div class="media-content">' +
            '<div class="content">' +
              '<p>' +
              '<span class="rcon">' +  json.object[i].content + '</span>' +
              '<br>' +
                '<small><span class="rname" style="font-size:14px;">' + json.object[i].userName + '</span>·<span class="rtime">' + json.object[i].reply_date + '</span></small>' +
              '</p>' +
            '</div>' +
          '</div>';
          mediaContent.appendChild(ms);
        }
      }else {
        alert('网络错误');
      }
    },

    error: function (json) {
      alert(JSON.stringify(json));
    },
  });
};

//加载评论
commentajax();




//回复话题
let replytopic = () => {
  reply.onclick = () => {
    if (replycontent != '') {
      $.ajax({
        type: 'post',
        datType: 'json',
        url: 'http://192.168.1.102:8080/YouNi/topicreply.do',
        data: {
          s_id: sid,
          topic_id: topicId,
          content: replycontent.value,
        },
        success: function (json) {
          if (json.status == 1) {
            window.location.href = 'communityInfo.html';
          }else {
            alert('网络错误');
          }
        },

        error: function (json) {
          alert(JSON.stringify(json));
        },
      });
    };
  };
};

//回复话题
replytopic();


</script>

  <script type="text/javascript" src="../js/module/Communityhurdles.js"></script>
    <script type="text/javascript" src = "../js/module/footer.js"></script>
